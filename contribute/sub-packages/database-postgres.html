<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Package Database-Postgres (SDB) | GNY Blockchain</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Decentralized machine learning on the blockchain">
    <meta property="article:modified_time" content="2020-01-10T13:54:39.000Z">
    <meta property="og:site_name" content="GNY Blockchain">
    <meta property="og:title" content="Package Database-Postgres (SDB)">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/contribute/sub-packages/database-postgres.html">
    <meta name="twitter:title" content="Package Database-Postgres (SDB)">
    <meta name="twitter:url" content="/contribute/sub-packages/database-postgres.html">
    <meta name="twitter:card" content="summary_large_image">
    
    <link rel="preload" href="/assets/css/0.styles.5e4fd02a.css" as="style"><link rel="preload" href="/assets/js/app.3570df00.js" as="script"><link rel="preload" href="/assets/js/4.109b8bd2.js" as="script"><link rel="preload" href="/assets/js/36.6a1ecf04.js" as="script"><link rel="prefetch" href="/assets/js/1.0651343c.js"><link rel="prefetch" href="/assets/js/10.3312b6d2.js"><link rel="prefetch" href="/assets/js/11.bdb7ceb2.js"><link rel="prefetch" href="/assets/js/12.7a4b1993.js"><link rel="prefetch" href="/assets/js/13.0782a537.js"><link rel="prefetch" href="/assets/js/14.f02d8a0b.js"><link rel="prefetch" href="/assets/js/15.60e54942.js"><link rel="prefetch" href="/assets/js/16.d9b875ab.js"><link rel="prefetch" href="/assets/js/17.16884c41.js"><link rel="prefetch" href="/assets/js/18.e62909e0.js"><link rel="prefetch" href="/assets/js/19.f76d887c.js"><link rel="prefetch" href="/assets/js/20.4fda2814.js"><link rel="prefetch" href="/assets/js/21.f55c3c72.js"><link rel="prefetch" href="/assets/js/22.03501c5a.js"><link rel="prefetch" href="/assets/js/23.1660cef2.js"><link rel="prefetch" href="/assets/js/24.cdc172e5.js"><link rel="prefetch" href="/assets/js/25.c477fe0c.js"><link rel="prefetch" href="/assets/js/26.ef658927.js"><link rel="prefetch" href="/assets/js/27.f8319e71.js"><link rel="prefetch" href="/assets/js/28.b6516670.js"><link rel="prefetch" href="/assets/js/29.3ac879c4.js"><link rel="prefetch" href="/assets/js/3.f0abff90.js"><link rel="prefetch" href="/assets/js/30.309e57bd.js"><link rel="prefetch" href="/assets/js/31.befdab7a.js"><link rel="prefetch" href="/assets/js/32.82b0df19.js"><link rel="prefetch" href="/assets/js/33.9e3b5cad.js"><link rel="prefetch" href="/assets/js/34.9d5cab1c.js"><link rel="prefetch" href="/assets/js/35.7c6f4007.js"><link rel="prefetch" href="/assets/js/37.52f4c3cc.js"><link rel="prefetch" href="/assets/js/38.2a7e4418.js"><link rel="prefetch" href="/assets/js/39.8aa18e3c.js"><link rel="prefetch" href="/assets/js/40.0e0c4615.js"><link rel="prefetch" href="/assets/js/41.be437d3f.js"><link rel="prefetch" href="/assets/js/42.08c6b306.js"><link rel="prefetch" href="/assets/js/43.53eb81af.js"><link rel="prefetch" href="/assets/js/44.516842ba.js"><link rel="prefetch" href="/assets/js/45.e57b94c7.js"><link rel="prefetch" href="/assets/js/46.f6ee4fac.js"><link rel="prefetch" href="/assets/js/47.63bdca55.js"><link rel="prefetch" href="/assets/js/48.d044551a.js"><link rel="prefetch" href="/assets/js/49.8efc8550.js"><link rel="prefetch" href="/assets/js/5.ffc0af70.js"><link rel="prefetch" href="/assets/js/50.a00020b7.js"><link rel="prefetch" href="/assets/js/51.daaed251.js"><link rel="prefetch" href="/assets/js/52.35544367.js"><link rel="prefetch" href="/assets/js/53.fb750f80.js"><link rel="prefetch" href="/assets/js/54.545ac1de.js"><link rel="prefetch" href="/assets/js/55.07f9fde1.js"><link rel="prefetch" href="/assets/js/56.ae49da62.js"><link rel="prefetch" href="/assets/js/57.051eccde.js"><link rel="prefetch" href="/assets/js/58.b67e87e6.js"><link rel="prefetch" href="/assets/js/59.92c637c5.js"><link rel="prefetch" href="/assets/js/6.5c784541.js"><link rel="prefetch" href="/assets/js/60.95a4092f.js"><link rel="prefetch" href="/assets/js/61.9bc8c91c.js"><link rel="prefetch" href="/assets/js/62.401248da.js"><link rel="prefetch" href="/assets/js/63.5d312c7b.js"><link rel="prefetch" href="/assets/js/64.98e4a03f.js"><link rel="prefetch" href="/assets/js/7.f83ca400.js"><link rel="prefetch" href="/assets/js/8.6de351e2.js"><link rel="prefetch" href="/assets/js/9.5a51e82d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5e4fd02a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">GNY Blockchain</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://www.gny.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Website
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/gnyio/gny-experiment" target="_blank" rel="noopener noreferrer" class="repo-link">
    GNY Source Code
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://www.gny.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Website
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/gnyio/gny-experiment" target="_blank" rel="noopener noreferrer" class="repo-link">
    GNY Source Code
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/run-node/" class="sidebar-heading clickable open"><span>Run Node with Docker</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/run-node/get-started.html" class="sidebar-link">Get Started</a></li><li><a href="/run-node/start-node.html" class="sidebar-link">Start node</a></li><li><a href="/run-node/configure.html" class="sidebar-link">Configure</a></li><li><a href="/run-node/manage-node.html" class="sidebar-link">Manage node</a></li><li><a href="/run-node/upgrade-node.html" class="sidebar-link">Upgrade Node</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/run-bare-metal-node" class="sidebar-heading clickable"><span>Run Bare Metal Node</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/run-bare-metal-node/get-started.html" class="sidebar-link">Get Started</a></li><li><a href="/run-bare-metal-node/start-node.html" class="sidebar-link">Start node</a></li><li><a href="/run-bare-metal-node/configure.html" class="sidebar-link">Configure</a></li><li><a href="/run-bare-metal-node/manage-node.html" class="sidebar-link">Manage node</a></li><li><a href="/run-bare-metal-node/upgrade-node.html" class="sidebar-link">Upgrade Node</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/http/" class="sidebar-heading clickable"><span>HTTP</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/http/api.html" class="sidebar-link">API</a></li><li><a href="/http/exchange-endpoints.html" class="sidebar-link">Exchange Endpoints</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/client/" class="sidebar-heading clickable"><span>JavaScript Client</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/client/install.html" class="sidebar-link">Install</a></li><li><a href="/client/api.html" class="sidebar-link">API</a></li><li><a href="/client/contract.html" class="sidebar-link">Contract</a></li><li><a href="/client/exchange.html" class="sidebar-link">Exchange API</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/cli/" class="sidebar-heading clickable"><span>CLI</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/cli/install.html" class="sidebar-link">Install</a></li><li><a href="/cli/commands.html" class="sidebar-link">Commands</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/guide/" class="sidebar-heading clickable"><span>Guides</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/create-p2p-secret.html" class="sidebar-link">Create P2P Secret</a></li><li><a href="/guide/create-secret.html" class="sidebar-link">Create Secret</a></li><li><a href="/guide/check-balance.html" class="sidebar-link">Check Balance</a></li><li><a href="/guide/get-gny-on-testnet.html" class="sidebar-link">Get GNY on Testnet</a></li><li><a href="/guide/show-address-from-secret.html" class="sidebar-link">Show Address from Secret</a></li><li><a href="/guide/how-to-send-transactions.html" class="sidebar-link">Send Transaction</a></li><li><a href="/guide/set-username.html" class="sidebar-link">Set Username</a></li><li><a href="/guide/register-as-delegate.html" class="sidebar-link">Register as Delegate</a></li><li><a href="/guide/vote-for-delegate.html" class="sidebar-link">Vote for Delegate</a></li><li><a href="/guide/unvote-delegate.html" class="sidebar-link">Unvote Delegate</a></li></ul></section></li><li><a href="/faq/" class="sidebar-link">FAQ</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="package-database-postgres-sdb"><a href="#package-database-postgres-sdb" class="header-anchor">#</a> Package Database-Postgres (SDB)</h1> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p>This package is a database abstraction with an inbuilt cahe. In the following we will call this package <code>sdb</code>. Sdb helds <em>most</em> of its data in memory and so saves round trips to the database. <code>Sdb</code> is intended to be used with smart contracts because it is able to <code>rollback</code> changes made by smart contract calls. But more on this later.</p> <h1 id="configuration"><a href="#configuration" class="header-anchor">#</a> Configuration</h1> <p>The constructor has the following signature:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">constructor</span><span class="token punctuation">(</span>logger<span class="token operator">:</span> ILogger<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> SmartDBOptions<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>So you need to at least provide an logger. The <code>SmartDBOptions</code> interface has the following structure:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">SmartDBOptions</span> <span class="token punctuation">{</span>
  <span class="token comment">// keep x last blocks in cache, default 10</span>
  cachedBlockCount<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token comment">// checks if properties are correct in update(), default undefined</span>
  checkModifier<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token comment">// stringified (JSON.stringify()) config</span>
  configRaw<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="life-cycle"><a href="#life-cycle" class="header-anchor">#</a> Life Cycle</h2> <p>Like a blockchain, <code>sdb</code> uses a form of <a href="https://de.wikipedia.org/wiki/Event_Sourcing" target="_blank" rel="noopener noreferrer">Event Sourcing<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> where every change in a data model is represented as a delta (<code>a -&gt; a'</code>). That makes it possible to <code>rollback</code> to a previous point in time.</p> <h3 id="block-life-cycle"><a href="#block-life-cycle" class="header-anchor">#</a> Block life cycle</h3> <p>Changes to the underlying data model are grouped by <code>Blocks</code>. Every <code>Block</code> has its transactions that call smart contracts and these smart contract calls produce the <code>deltas</code>.</p> <p>An example block:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;payloadHash&quot;</span><span class="token operator">:</span> <span class="token string">&quot;e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;prevBlockId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;c35e589dda915d150650dea409f6e92a83bae4a70273a5e29e1e6751310c95d0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;delegate&quot;</span><span class="token operator">:</span> <span class="token string">&quot;e43bb2cc9d5591d00344c1c49b99b6404a73fd98380386276670a0111a72c6fc&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;height&quot;</span><span class="token operator">:</span> <span class="token string">&quot;10&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;count&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">&quot;fees&quot;</span><span class="token operator">:</span> <span class="token string">&quot;510000000&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;reward&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;signature&quot;</span><span class="token operator">:</span> <span class="token string">&quot;c69c57fdb40a1b378c8c8456e52657ae8041a65d895e438782d71c6b7a7115d03d48cf1628a11cdfd302b22771009d902628c8882d97f9865d3bf36a1ecec306&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;6a478f6e34442a090c868d6285d4ee07f8e13dad682eff3ebd38d3021e36b706&quot;</span>
  <span class="token comment">// transactions property is further below</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>This are the transactions of the <code>Block</code> above:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;transactions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span> <span class="token number">23708761</span><span class="token punctuation">,</span>
      <span class="token property">&quot;fee&quot;</span><span class="token operator">:</span> <span class="token string">&quot;10000000&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token string">&quot;[500000000,\&quot;GuQr4DM3aiTD36EARqDpbfsEHoNF\&quot;]&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;senderPublicKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;575bf8f32b941b9e6ae1af82539689198327b73d77d22a98cdef2460c9257f7b&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;senderId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;G4GDW6G78sgQdSdVAQUXdm5xPS13t&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;signatures&quot;</span><span class="token operator">:</span> <span class="token string">&quot;[\&quot;842921a4788007c38fad7ce82425fe7e1e9dfa1e367002a596583f06db4ff9019eb669217272466c7258ed4251d552a20a226a86a1cc70c70acfb4ed7ce71d0a\&quot;]&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;4c5511362b2b75a6e61e028c379c2ea75b515e06ae6955c60579d04d41b7d2df&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;height&quot;</span><span class="token operator">:</span> <span class="token string">&quot;10&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;_version_&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span> <span class="token number">23708767</span><span class="token punctuation">,</span>
      <span class="token property">&quot;fee&quot;</span><span class="token operator">:</span> <span class="token string">&quot;500000000&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token string">&quot;[\&quot;liangpeili\&quot;]&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;senderPublicKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;575bf8f32b941b9e6ae1af82539689198327b73d77d22a98cdef2460c9257f7b&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;senderId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;G4GDW6G78sgQdSdVAQUXdm5xPS13t&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;signatures&quot;</span><span class="token operator">:</span> <span class="token string">&quot;[\&quot;f1d50b00c1a8fb38d3e68f300a101c0537a350c3f10b1a084afb4acac7fae99c8a4613d9e44fa0d1c3df3f985c02d35b9d476f8cb5f3731fb34e0ede263db008\&quot;]&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fdd1be8a774e3b1537124656f9037cdcfa2b5dddfa26fd24fecaa9a0f1b2b995&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;height&quot;</span><span class="token operator">:</span> <span class="token string">&quot;10&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;_version_&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>The <code>Transactions</code> above would call the following smart contracts:</p> <ul><li><code>basic.transfer</code> (type: 0)</li> <li><code>basic.setUserName</code> (type: 1)</li></ul> <p>The whole <code>Block</code> would then produce the following <code>deltas</code> (from which SQL statements can be generated):</p> <details><summary>CLICK ME</summary> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Account&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;primaryKey&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;G4GDW6G78sgQdSdVAQUXdm5xPS13t&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dbVersion&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;propertyChanges&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gny&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;39999999990000000&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token string">&quot;40000000000000000&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;_version_&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Account&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;primaryKey&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;GuQr4DM3aiTD36EARqDpbfsEHoNF&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dbVersion&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;propertyChanges&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;address&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;GuQr4DM3aiTD36EARqDpbfsEHoNF&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gny&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;500000000&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;isDelegate&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;isLocked&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lockHeight&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lockAmount&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;_version_&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Account&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;primaryKey&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;G4GDW6G78sgQdSdVAQUXdm5xPS13t&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dbVersion&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token property">&quot;propertyChanges&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gny&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;39999999490000000&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token string">&quot;39999999990000000&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;_version_&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Transfer&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;primaryKey&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;tid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;4c5511362b2b75a6e61e028c379c2ea75b515e06ae6955c60579d04d41b7d2df&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dbVersion&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;propertyChanges&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tid&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;4c5511362b2b75a6e61e028c379c2ea75b515e06ae6955c60579d04d41b7d2df&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;height&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;10&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;senderId&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;G4GDW6G78sgQdSdVAQUXdm5xPS13t&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;recipientId&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;GuQr4DM3aiTD36EARqDpbfsEHoNF&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;recipientName&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;currency&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;GNY&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;amount&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;500000000&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;timestamp&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token number">23708761</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;_version_&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Account&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;primaryKey&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;G4GDW6G78sgQdSdVAQUXdm5xPS13t&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dbVersion&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token property">&quot;propertyChanges&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gny&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;39999998990000000&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token string">&quot;39999999490000000&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;_version_&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token number">3</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Account&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;primaryKey&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;G4GDW6G78sgQdSdVAQUXdm5xPS13t&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dbVersion&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">&quot;propertyChanges&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;liangpeili&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;_version_&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token number">4</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Transaction&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;primaryKey&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;4c5511362b2b75a6e61e028c379c2ea75b515e06ae6955c60579d04d41b7d2df&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dbVersion&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;propertyChanges&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;timestamp&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token number">23708761</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fee&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;10000000&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;args&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;[500000000,\&quot;GuQr4DM3aiTD36EARqDpbfsEHoNF\&quot;]&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;senderPublicKey&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;575bf8f32b941b9e6ae1af82539689198327b73d77d22a98cdef2460c9257f7b&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;senderId&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;G4GDW6G78sgQdSdVAQUXdm5xPS13t&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;signatures&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;[\&quot;842921a4788007c38fad7ce82425fe7e1e9dfa1e367002a596583f06db4ff9019eb669217272466c7258ed4251d552a20a226a86a1cc70c70acfb4ed7ce71d0a\&quot;]&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;4c5511362b2b75a6e61e028c379c2ea75b515e06ae6955c60579d04d41b7d2df&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;height&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;10&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;_version_&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Transaction&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;primaryKey&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fdd1be8a774e3b1537124656f9037cdcfa2b5dddfa26fd24fecaa9a0f1b2b995&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dbVersion&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;propertyChanges&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;timestamp&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token number">23708767</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fee&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;500000000&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;args&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;[\&quot;liangpeili\&quot;]&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;senderPublicKey&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;575bf8f32b941b9e6ae1af82539689198327b73d77d22a98cdef2460c9257f7b&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;senderId&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;G4GDW6G78sgQdSdVAQUXdm5xPS13t&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;signatures&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;[\&quot;f1d50b00c1a8fb38d3e68f300a101c0537a350c3f10b1a084afb4acac7fae99c8a4613d9e44fa0d1c3df3f985c02d35b9d476f8cb5f3731fb34e0ede263db008\&quot;]&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fdd1be8a774e3b1537124656f9037cdcfa2b5dddfa26fd24fecaa9a0f1b2b995&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;height&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;10&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;_version_&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Delegate&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;primaryKey&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;G3bh654XQD3V6TP5aH4KspdPybYgX&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dbVersion&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;propertyChanges&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;producedBlocks&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;_version_&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Round&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;primaryKey&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;round&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dbVersion&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;propertyChanges&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fee&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token string">&quot;510000000&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;_version_&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;current&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">&quot;original&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br></div></div></details> <h3 id="version-column"><a href="#version-column" class="header-anchor">#</a> Version Column</h3> <p>Every Entity has a <code>_version_</code> column which specifies how often it was updated.</p> <p>An <code>Account</code> Entity (version 1):</p> <table><thead><tr><th style="text-align:center;">address</th> <th style="text-align:center;">gny</th> <th style="text-align:center;">username</th> <th style="text-align:center;">version</th></tr></thead> <tbody><tr><td style="text-align:center;">G45U8A2vdp5CHZ3ABAZwojxdBp44p</td> <td style="text-align:center;">39999998990000000</td> <td style="text-align:center;">null</td> <td style="text-align:center;">1</td></tr></tbody></table> <p>An <code>Account</code> Entity (version 2) where the <code>username</code> was set:</p> <table><thead><tr><th style="text-align:center;">address</th> <th style="text-align:center;">gny</th> <th style="text-align:center;">username</th> <th style="text-align:center;">version</th></tr></thead> <tbody><tr><td style="text-align:center;">G45U8A2vdp5CHZ3ABAZwojxdBp44p</td> <td style="text-align:center;">39999998990000000</td> <td style="text-align:center;">liangpeili</td> <td style="text-align:center;">2</td></tr></tbody></table> <h2 id="database-access"><a href="#database-access" class="header-anchor">#</a> Database Access</h2> <p>All <code>create</code>/<code>update</code>/<code>delete</code> statements are first executed only in memory. Every 10 seconds all collected <code>create</code>/<code>update</code>/<code>delete</code> statements are batched to the database. This is done by a Block <code>commit</code>. In summary: The database gets <strong>synchronized</strong> with the in-memory data every 10 seconds.</p> <h2 id="model"><a href="#model" class="header-anchor">#</a> Model</h2> <p>Models are divided into <code>memory</code> models and <code>normal</code> models.</p> <h3 id="memory-models"><a href="#memory-models" class="header-anchor">#</a> Memory Models</h3> <p>Memory models are solely kept in memory and written to to disc on every Block <code>commit</code>. They are once loaded on the start of the application to memory and are then never read again as long as the Blockchain is up.</p> <h3 id="normal-models"><a href="#normal-models" class="header-anchor">#</a> Normal Models</h3> <p>On the other hand, <code>normal</code> models do only keep a limited number of records in memory. So it is not guaranteed that an entity of a <code>normal</code> model is in cache. Normal models are not loaded into memory on startup.</p> <h2 id="smart-contract-usage"><a href="#smart-contract-usage" class="header-anchor">#</a> Smart Contract Usage</h2> <p>When working with smart contracts we want to rollback changes when something goes wrong. Therefore we have the <code>beginContract()</code>, <code>commitContract()</code> and <code>rollbackContract()</code>.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token function">beginContract</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">Transactions</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// calls contract</span>
  global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token function">commitContract</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token function">rollbackContract</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// rollback on error</span>
  <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="api"><a href="#api" class="header-anchor">#</a> API</h2> <blockquote><p>IMPORTANT!<br> <strong>All</strong> API methods that <strong>change</strong> (<code>create</code>, <code>update</code>, <code>delete</code>) Entites should only be used within contracts. On the other hand the API methods that <strong>read directly</strong> from the Database are meant to be mainly used in HTTP endpoints.</p></blockquote> <h3 id="startup-and-configuration"><a href="#startup-and-configuration" class="header-anchor">#</a> Startup and Configuration</h3> <p>In order to use the <code>sdb</code> package one has to first call the <code>init()</code> method.</p> <h4 id="init-promise-void"><a href="#init-promise-void" class="header-anchor">#</a> init(): Promise&lt;void&gt;</h4> <p><strong>Returns</strong>: <code>void</code><br> <strong>Description</strong>: This operation is mandatory and initializes the <code>sdb</code> package. Initialization includes connecting to the Database, loading the last block, setting the latest block height, loads all entities of the memory models, loading the <code>BlockHistory</code> of the latest block.</p> <h3 id="create-t-t-object-promise-t"><a href="#create-t-t-object-promise-t" class="header-anchor">#</a> create&lt;T&gt;(T, Object): Promise&lt;T&gt;</h3> <p><strong>Returns</strong>: <code>Promise&lt;T&gt;</code> (an Entity with all default values set)<br> <strong>Description</strong>: This operation creates an entity where default values are set. At least the keys (primary keys, composite keys, unique keys) need to be set.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// create an Account</span>
<span class="token keyword">const</span> created <span class="token operator">=</span> <span class="token keyword">await</span> sdb<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">create</span><span class="token generic class-name"><span class="token operator">&lt;</span>Account<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Account<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  address<span class="token operator">:</span> <span class="token string">'G45U8A2vdp5CHZ3ABAZwojxdBp44p'</span><span class="token punctuation">,</span>
  gny<span class="token operator">:</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>created<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;G45U8A2vdp5CHZ3ABAZwojxdBp44p&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;gny&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;username&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token string">&quot;isDelegate&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">&quot;isLocked&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">&quot;lockHeight&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;lockAmount&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;_version_&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="get-t-t-object-promise-t-void"><a href="#get-t-t-object-promise-t-void" class="header-anchor">#</a> get&lt;T&gt;(T, Object): Promise&lt;T | void&gt;</h3> <blockquote><p>Warning: This works only for <code>memory models</code>.</p></blockquote> <p><strong>Returns</strong>: When found in cache then it returns the entity otherwise it returns <code>undefined</code>.<br> <strong>Description</strong>: This operation solely looks into the cache. It works with PrimaryKeys, UniqueKeys and Composite Keys. If not the whole composite key is provided it throws.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> resultPrimaryKey <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token operator">&lt;</span>Delegate<span class="token operator">&gt;</span><span class="token punctuation">(</span>Delegate<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  address<span class="token operator">:</span> <span class="token string">&quot;G45U8A2vdp5CHZ3ABAZwojxdBp44p&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> resultUniqueKey <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token operator">&lt;</span>Delegate<span class="token operator">&gt;</span><span class="token punctuation">(</span>Delegate<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  tid<span class="token operator">:</span> <span class="token string">&quot;1828313037dabeb911604a2b740821e2037f28e32cfc0794ad7cdb96ef2361e1&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> compositeKeyResult <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token operator">&lt;</span>Balance<span class="token operator">&gt;</span><span class="token punctuation">(</span>Balance<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  address<span class="token operator">:</span> <span class="token string">&quot;G45U8A2vdp5CHZ3ABAZwojxdBp44p&quot;</span><span class="token punctuation">,</span>
  currency<span class="token operator">:</span> <span class="token string">&quot;ABC.ABC&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="getall-t-t-promise-t"><a href="#getall-t-t-promise-t" class="header-anchor">#</a> getAll&lt;T&gt;(T): Promise&lt;T[]&gt;</h3> <blockquote><p>Warning: This works only for <code>memory models</code>.</p></blockquote> <p><strong>Returns</strong>: When found in cache then it returns the entities otherwise it returns an empty array.<br> <strong>Description</strong>: This operation solely looks into the cache. It returns all entities of a given memory model.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> allDelegates<span class="token operator">:</span> Delegate<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">getAll</span><span class="token generic class-name"><span class="token operator">&lt;</span>Delegate<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Delegate<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="load-t-t-object-promise-t-void"><a href="#load-t-t-object-promise-t-void" class="header-anchor">#</a> load&lt;T&gt;(T, Object): Promise&lt;T | void&gt;</h3> <p><strong>Returns</strong>: When found it returns the searched object. When not found then it returns <code>undefined</code>.<br> <strong>Description</strong>: This operation tries to load the entity from cache and returns entity if found in cache. If the entity was not found cache - then it hits the DB and returns the entity from the db. When the entity is not in the db - then it returns <code>undefined</code>. This operation supports PrimaryKeys, CompositeKeys and UniqueKeys.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// load by primary key</span>
<span class="token keyword">const</span> resultPrimaryKey <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">load</span><span class="token generic class-name"><span class="token operator">&lt;</span>Account<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Account<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  account<span class="token operator">:</span> <span class="token string">&quot;G45U8A2vdp5CHZ3ABAZwojxdBp44p&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// load by unique key</span>
<span class="token keyword">const</span> resultUniqueKey <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">load</span><span class="token generic class-name"><span class="token operator">&lt;</span>Account<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Account<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  username<span class="token operator">:</span> <span class="token string">&quot;xpgeng&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// load composite key</span>
<span class="token keyword">const</span> compositeKey <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">load</span><span class="token generic class-name"><span class="token operator">&lt;</span>Vote<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Vote<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  voterAddress<span class="token operator">:</span> <span class="token string">&quot;G45U8A2vdp5CHZ3ABAZwojxdBp44p&quot;</span><span class="token punctuation">,</span>
  delegate<span class="token operator">:</span> <span class="token string">&quot;liangpeili&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="createorload-t-t-object"><a href="#createorload-t-t-object" class="header-anchor">#</a> createOrLoad&lt;T&gt;(T, Object)</h3> <p><strong>Returns</strong>: <code>Promise&lt;{ create: boolean; entity: T }&gt;</code> (if property <code>create</code> is true then a new Object was created; if property <code>create</code> is false then the entity was loaded by its primary key. Either way the property <code>entity</code> is always set)<br> <strong>Description</strong>: As the name suggest this method is composed of <code>create</code> and <code>load</code>. If the entity can not be loaded from cache or db then it is created.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// create</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> create<span class="token punctuation">,</span> entity <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> sdb<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">createOrLoad</span><span class="token generic class-name"><span class="token operator">&lt;</span>Round<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Round<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  round<span class="token operator">:</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  fee<span class="token operator">:</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  reward<span class="token operator">:</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>create<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;round&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;reward&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;fee&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment">// load</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> create<span class="token punctuation">,</span> entity <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> sdb<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">createOrLoad</span><span class="token generic class-name"><span class="token operator">&lt;</span>Round<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Round<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  round<span class="token operator">:</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>create<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;round&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3001&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;reward&quot;</span><span class="token operator">:</span> <span class="token string">&quot;200000000&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;fee&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="del-t-t-objectwithprimarykey-s-promise-void"><a href="#del-t-t-objectwithprimarykey-s-promise-void" class="header-anchor">#</a> del&lt;T&gt;(T, ObjectWithPrimaryKey(s)): Promise&lt;void&gt;</h3> <p><strong>Returns</strong>: <code>Promise&lt;undefined&gt;</code><br> <strong>Description</strong>: This operation deletes an Entity by its primary key, composite keys or unique key.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">await</span> sdb<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">del</span><span class="token generic class-name"><span class="token operator">&lt;</span>Vote<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Vote<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  voterAddress<span class="token operator">:</span> <span class="token string">&quot;G45U8A2vdp5CHZ3ABAZwojxdBp44p&quot;</span><span class="token punctuation">,</span>
  delegate<span class="token operator">:</span> <span class="token string">&quot;a1300&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="update-t-t-objectwithupdatedprops-objectwithprimarykey-s-promise-void"><a href="#update-t-t-objectwithupdatedprops-objectwithprimarykey-s-promise-void" class="header-anchor">#</a> update&lt;T&gt;(T, ObjectWithUpdatedProps, ObjectWithPrimaryKey(s)): Promise&lt;void&gt;</h3> <p><strong>Returns</strong>: <code>Promise&lt;undefined&gt;</code><br> <strong>Description</strong>: Checks if the property which should be updated is in memory, if not it loads it in memory. In the example below the Account <code>G4C9q...</code> gets the new <code>gny</code> balance of <code>'20000000000'</code>. This operation increments the <code>_version_</code> property of each Entity by one.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">await</span> sdb<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">update</span><span class="token generic class-name"><span class="token operator">&lt;</span>Account<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  Account<span class="token punctuation">,</span>
  <span class="token punctuation">{</span> gny<span class="token operator">:</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">20000000000</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> address<span class="token operator">:</span> <span class="token string">&quot;G4C9qLAE4TiuNhjg2RXZYVsMtPdK4&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="lock-uniquelock-void"><a href="#lock-uniquelock-void" class="header-anchor">#</a> lock(uniqueLock): void</h3> <p><strong>Returns</strong>: undefined<br> <strong>Description</strong>: Should be only used within smart contract calls. This operation makes a duplicate call to a smart contract within a block impossible. It throws if the same unique identifier is called twice.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">smartContract</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> account<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>senderId<span class="token punctuation">.</span>address<span class="token punctuation">;</span>
  global<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">basic.myContract@</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>account<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ... code omitted</span>
<span class="token punctuation">}</span>

<span class="token function">smartContract</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// works</span>
<span class="token function">smartContract</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// throws within same block</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="increase-t-t-objectwithpropertiestoincrease-objectwithprimarykey-s-promise-partial-t"><a href="#increase-t-t-objectwithpropertiestoincrease-objectwithprimarykey-s-promise-partial-t" class="header-anchor">#</a> increase&lt;T&gt;(T, ObjectWithPropertiesToIncrease, ObjectWithPrimaryKey(s)): Promise&lt;Partial&lt;T&gt;&gt;</h3> <p><strong>Returns</strong>: <code>Promise&lt;Partial&lt;T&gt;&gt;</code><br> <strong>Description</strong>: Increases the provided properties by a specific Number. This is supported for <code>Numbers</code> and <code>Strings</code> Numbers (e.g. <code>'100000000'</code>). This operation returns only the updated properties of the Entity.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> account<span class="token operator">:</span> Account <span class="token operator">=</span> <span class="token punctuation">{</span>
  address<span class="token operator">:</span> <span class="token string">'G2Ujin7eS9M857JxpnLVUpr6h6RmU'</span><span class="token punctuation">,</span>
  gny<span class="token operator">:</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">200000000000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">increase</span><span class="token generic class-name"><span class="token operator">&lt;</span>Account<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  Account<span class="token punctuation">,</span>
  <span class="token punctuation">{</span> gny<span class="token operator">:</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">200000000000</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> address<span class="token operator">:</span> <span class="token string">'G2Ujin7eS9M857JxpnLVUpr6h6RmU'</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;gny&quot;</span><span class="token operator">:</span> <span class="token string">&quot;400000000000&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="findone-t-t-findoneoptions-promise-t-void"><a href="#findone-t-t-findoneoptions-promise-t-void" class="header-anchor">#</a> findOne&lt;T&gt;(T, FindOneOptions): Promise&lt;T | void&gt;</h3> <blockquote><p>Warning 1: This operation directly accesses the database without looking into the cache.<br>
Warning 2: When the database query returns more than one result an Exception is thrown.</p></blockquote> <p><strong>Returns</strong>: <code>Promise&lt;T | void&gt;</code><br> <strong>Description</strong>: This operation queries directly the database.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// findOneOptions:</span>
<span class="token keyword">interface</span> <span class="token class-name">FindOneOptions<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  condition<span class="token operator">:</span> Partial<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">findOne</span><span class="token generic class-name"><span class="token operator">&lt;</span>Asset<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Asset<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  condition<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;ACC.ACC&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="findall-t-t-findalloptions-promise-t"><a href="#findall-t-t-findalloptions-promise-t" class="header-anchor">#</a> findAll&lt;T&gt;(T, FindAllOptions): Promise&lt;T[]&gt;</h3> <blockquote><p>Warning: This operation directly accesses the database without looking into the cache.</p></blockquote> <p><strong>Returns</strong>: <code>Promise&lt;T[]&gt;</code><br> <strong>Description</strong>: This operation accesses directly the database. It supports <code>pagination</code> (limit, offset) and <code>$in</code> (WHERE IN) operations (see example):</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// search by single property (e.g get all blocks forged by a delegate)</span>
<span class="token keyword">const</span> resultSingle <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">findAll</span><span class="token generic class-name"><span class="token operator">&lt;</span>Block<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Block<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  condition<span class="token operator">:</span> <span class="token punctuation">{</span>
    delegate<span class="token operator">:</span> <span class="token string">'47affc7358eef12bd40b92de868769cc1a7dc2a765835989bd9554615cb00e31'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// search by WHERE IN</span>
<span class="token keyword">const</span> resultWhereIn <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">findAll</span><span class="token generic class-name"><span class="token operator">&lt;</span>Delegate<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Delegate<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  condition<span class="token operator">:</span> <span class="token punctuation">{</span>
    username<span class="token operator">:</span> <span class="token punctuation">{</span>
      $<span class="token keyword">in</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'gny_d29'</span><span class="token punctuation">,</span> <span class="token string">'gny_d99'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// sort result (all Delegates order by producedBlocks descending)</span>
<span class="token keyword">const</span> resultSort <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">findAll</span><span class="token generic class-name"><span class="token operator">&lt;</span>Delegate<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Delegate<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  condition<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  sort<span class="token operator">:</span> <span class="token punctuation">{</span>
    producedBlocks<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// -1 descending, 1 ascending</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// limit and offset (all Delegates in descending order, take only 10)</span>
<span class="token keyword">const</span> resultLimtOffset <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">findAll</span><span class="token generic class-name"><span class="token operator">&lt;</span>Delegate<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Delegate<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  condition<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  sort<span class="token operator">:</span> <span class="token punctuation">{</span>
    producedBlocks<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  limit<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  offfset<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// search for a range of values</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">findAll</span><span class="token generic class-name"><span class="token operator">&lt;</span>Transaction<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Transaction<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  condition<span class="token operator">:</span> <span class="token punctuation">{</span>
    height<span class="token operator">:</span> <span class="token punctuation">{</span>
      $gte<span class="token operator">:</span> minHeight<span class="token punctuation">,</span>
      $lte<span class="token operator">:</span> maxHeight<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h3 id="exists-t-t-object-arrayobject-promise-boolean"><a href="#exists-t-t-object-arrayobject-promise-boolean" class="header-anchor">#</a> exists&lt;T&gt;(T, Object | ArrayObject): Promise&lt;boolean&gt;</h3> <blockquote><p>Warning 1: This operation directly accesses the database<br>
Warning 2: This does not work for composite keys, only for UniqueKeys and PrimaryKeys</p></blockquote> <p><strong>Returns</strong>: <code>Promise&lt;boolean&gt;</code><br> <strong>Description</strong>: With this operation you can check if a given item exists already in the database. You can also check if any of the provided items (in an <code>Array</code>) are in the database present.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// check if account name is already in database (e.g. before r)</span>
<span class="token keyword">const</span> existsSingleProp <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">exists</span><span class="token generic class-name"><span class="token operator">&lt;</span>Account<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Account<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  username<span class="token operator">:</span> <span class="token string">&quot;liangpeili&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// check if any of any of the transactionIds are in the database</span>
<span class="token keyword">const</span> existsAnyOfArray <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">exists</span><span class="token generic class-name"><span class="token operator">&lt;</span>Transaction<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Transaction<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;740aebcd6d10760cdc84f8a7f3636bf3c47dc6f6fe354b4fa485beeb21dfb9e1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;f879ee1adccb5baad556f8f4d5e2782ff75fe766024ce4917e7998ab8e28b785&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;353fa1fec05d0f09fbe9329c1359c4af59ca98b5955201dae00c8858e209e12c&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// this will throw an Exception (because it uses more than 1 property)</span>
<span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">exists</span><span class="token generic class-name"><span class="token operator">&lt;</span>Vote<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Vote<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  voterAddress<span class="token operator">:</span> <span class="token string">&quot;G4C9qLAE4TiuNhjg2RXZYVsMtPdK4&quot;</span><span class="token punctuation">,</span>
  delegate<span class="token operator">:</span> <span class="token string">&quot;gny_d93&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="count-t-t-object-promise-number"><a href="#count-t-t-object-promise-number" class="header-anchor">#</a> count&lt;T&gt;(T, Object): Promise&lt;number&gt;</h3> <p>Warning: This operation directly accesses the database.</p> <p><strong>Returns</strong>: <code>Number</code><br> <strong>Description</strong>: This operation counts how many items are in the database. This operation supports the <code>$in</code> (WHERE IN) operator and the range of values (<code>$gte</code>, <code>$lte</code>) operators.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>
<span class="token comment">// count all Transactions</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">count</span><span class="token generic class-name"><span class="token operator">&lt;</span>Transaction<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Transaction<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// count all Transaction that were generated by delegate x</span>
<span class="token keyword">const</span> resultOne <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">count</span><span class="token generic class-name"><span class="token operator">&lt;</span>Transaction<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Transaction<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  delegate<span class="token operator">:</span> <span class="token string">'71ac46cad34569d8948eda6aff2e9f5de5734fef9c22449ed61387034f6efd6d'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// count all Transactions between block 1 and 10 (a range)</span>
<span class="token keyword">const</span> resultRange <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">count</span><span class="token generic class-name"><span class="token operator">&lt;</span>Transaction<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Transaction<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  height<span class="token operator">:</span> <span class="token punctuation">{</span>
    $gte<span class="token operator">:</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    $lte<span class="token operator">:</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// count all Transactions for Block 1, 33, 74</span>
count resultWhereIn <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">count</span><span class="token generic class-name"><span class="token operator">&lt;</span>Transaction<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Transaction<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  height<span class="token operator">:</span> <span class="token punctuation">{</span>
    $<span class="token keyword">in</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">74</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="query-blocks"><a href="#query-blocks" class="header-anchor">#</a> Query Blocks</h3> <h4 id="getblockbyheight-height-withtransactions-false-promise-block-void"><a href="#getblockbyheight-height-withtransactions-false-promise-block-void" class="header-anchor">#</a> getBlockByHeight(height, withTransactions = false): Promise&lt;Block | void&gt;</h4> <p><strong>Returns</strong>: <code>Promise&lt;Block | void&gt;</code><br> <strong>Description</strong>: If the Block was found in Cache or in the DB the Block gets returned. Otherwise <code>undefined</code> is returned. If wanted, the Block can be returned with transactions.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> block <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token function">getBlockByHeight</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token number">4215</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> blockWithTransactions <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token function">getBlockByHeight</span><span class="token punctuation">(</span>
  <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">242</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token boolean">true</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="getblockbyid-id-withtransactions-false-promise-block-void"><a href="#getblockbyid-id-withtransactions-false-promise-block-void" class="header-anchor">#</a> getBlockById(id, withTransactions = false): Promise&lt;Block | void&gt;</h4> <p><strong>Returns</strong>: <code>Promise&lt;Block | void&gt;</code><br> <strong>Description</strong>: If the Block was found in Cache or in the DB the Block gets returned. Otherwise <code>undefined</code> is returned. If wanted, the Block can be returned with transactions.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> block <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token function">getBlockById</span><span class="token punctuation">(</span>
  <span class="token string">&quot;2086c3e1b04186bd6a3da2335dca1c93806db00060532a17be3d2506935df918&quot;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> blockWithTransactions <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token function">getBlockById</span><span class="token punctuation">(</span>
  <span class="token string">&quot;fa410914aa466ee1a0e4057075dff60f6c0e596e8bff7fe9ad3a64abac4b5b92&quot;</span><span class="token punctuation">,</span>
  <span class="token boolean">true</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="getblocksbyheightrange-min-max-withtransactions-false-promise-block"><a href="#getblocksbyheightrange-min-max-withtransactions-false-promise-block" class="header-anchor">#</a> getBlocksByHeightRange(min, max, withTransactions = false): Promise&lt;Block[]&gt;</h4> <blockquote><p>Warning: Directly hits the database.</p></blockquote> <p><strong>Returns</strong>: <code>Promise&lt;Block[]&gt;</code><br> <strong>Description</strong>: This operation directly accesses the database. If wanted, the Block can be returned with transactions. Throws if max height is bigger than min height.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> block <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token function">getBlocksByHeightRange</span><span class="token punctuation">(</span>
  <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> blockWithTransactions <span class="token operator">=</span> <span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token function">getBlocksByHeightRange</span><span class="token punctuation">(</span>
  <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token boolean">true</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="simple-properties"><a href="#simple-properties" class="header-anchor">#</a> Simple Properties</h3> <h4 id="lastblockheight-string"><a href="#lastblockheight-string" class="header-anchor">#</a> lastBlockHeight: string</h4> <p><strong>Returns</strong>: <code>string</code><br> <strong>Description</strong>: This property returns the lastBlockHeight, which is a string.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> block1 <span class="token operator">=</span> <span class="token function">createBlock</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token function">beginBlock</span><span class="token punctuation">(</span>block1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token function">commitBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> lastHeight<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span>lastBlockHeight<span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>lastHeight<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;1&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="blockscount-string"><a href="#blockscount-string" class="header-anchor">#</a> blocksCount: string</h4> <p><strong>Returns</strong>: <code>string</code><br> <strong>Description</strong>: This property returns the blockCount, which is a string.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> block5 <span class="token operator">=</span> <span class="token function">createBlock</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token function">beginBlock</span><span class="token punctuation">(</span>block5<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token function">commitBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> blocksCount<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span>blocksCount<span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blocksCount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;6&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="lastblock-block"><a href="#lastblock-block" class="header-anchor">#</a> lastBlock: Block</h4> <p><strong>Returns</strong>: <code>Block</code><br> <strong>Description</strong>: This property returns the lastBlock.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> third <span class="token operator">=</span> <span class="token function">createBlock</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token function">beginBlock</span><span class="token punctuation">(</span>third<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token function">commitBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> lastBlock <span class="token operator">=</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span>lastBlock<span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>lastBlock<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;version&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">&quot;delegate&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a71ec9e6eebbd70068a6c3a3c74addd5e51172a6ce96ac40c92203995a205e10&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;height&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;prevBlockId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3e7db3d69080e8d360e3c4277602edd49d0509077914347d50cf3313c5296d7e&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;timestamp&quot;</span><span class="token operator">:</span> <span class="token number">24767180</span><span class="token punctuation">,</span>
  <span class="token string">&quot;transactions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">&quot;count&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">&quot;fees&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;payloadHash&quot;</span><span class="token operator">:</span> <span class="token string">&quot;e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;reward&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;signature&quot;</span><span class="token operator">:</span> <span class="token string">&quot;526bb84000f2429a2823888e96a9eda59fd9a8a86f00dd8a8bdaebafba801e52d41e55bb7a524e7c1631fb5bbeabd367211c4760706621994e9c8afccc1d7c05&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;5fa64f2b54fc68da15bfb9b598adb276340b5495971da777ececc90e0034c673&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="block-related-methods"><a href="#block-related-methods" class="header-anchor">#</a> Block related Methods</h3> <h4 id="beginblock-block-void"><a href="#beginblock-block-void" class="header-anchor">#</a> beginBlock(Block): void</h4> <p><strong>Returns:</strong> <code>void</code><br> <strong>Description:</strong> This operation prepares the the Block to commit.</p> <h4 id="commitblock-promise-string"><a href="#commitblock-promise-string" class="header-anchor">#</a> commitBlock(): Promise&lt;string&gt;</h4> <p><strong>Returns</strong>: LastBlockHeight<br> <strong>Description:</strong> This operation writes all changes made (smart contract calls, updated round info, updated delegate info) to the database.</p> <h4 id="rollbackblock-height-promise-void"><a href="#rollbackblock-height-promise-void" class="header-anchor">#</a> rollbackBlock(height?): Promise&lt;void&gt;</h4> <p><strong>Returns:</strong> <code>void</code><br> <strong>Description</strong> This operation serves two purposes. First, when called without a height parameter then it rollbacks the current Block in case something went wrong (see the example). Second, it can be used to rollback to a previous Block in case of a Fork in the network.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// when something goes wrong by applying the block, it makes sure that all operations are reverted to the previous state</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token function">beginBlock</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token function">commitBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token function">rollbackBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// in case of a fork we can rollback to a previous block</span>
<span class="token keyword">const</span> lastBlock<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span>lastBlockHeight<span class="token punctuation">;</span> <span class="token comment">// e.g. 1034</span>
global<span class="token punctuation">.</span>app<span class="token punctuation">.</span>sdb<span class="token punctuation">.</span><span class="token function">rollbackBlock</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token number">1030</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// rollback to 1030</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/gnyio/gny-docs/edit/master/docs/contribute/sub-packages/database-postgres.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/10/2020, 1:54:39 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3570df00.js" defer></script><script src="/assets/js/4.109b8bd2.js" defer></script><script src="/assets/js/36.6a1ecf04.js" defer></script>
  </body>
</html>
